<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>WW2 Visualization</title>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="datamaps.world.min.js"></script> <!-- documentation https://github.com/markmarkoh/datamaps -->
<style>
</style>
</head>

<body>

<div id="map"></div>

Bubbles: <input type="checkbox" onchange="toggleBubbles();" checked /><br />
<button onclick="resetZoom();">Reset zoom</button>


<script>

var bubble_map = new Datamap({
    height:660,
    width:960,
    projection:"mercator",
    element: document.getElementById("map"),
    geographyConfig: {
        popupOnHover: true,
        highlightOnHover: true
    },
    fills: {
        defaultFill: '#ABDDA4',
        Attacker: 'red',
        Defender: 'blue'
    },
    done: function(datamap) {
        datamap.svg.call(d3.behavior.zoom().on("zoom", redraw));
        function redraw() {
            datamap.svg.selectAll("g").attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        };
    }
});
var bubblesShow = true;
var bubble_popup = function(geo, data) {
  return '<div class="hoverinfo">Yield:' + data.yeild + 'Exploded on ' + data.date + ' by the '  + data.country + '';
};
var bubbles = [
  {
    name: 'Not a bomb, but centered on Brazil',
    radius: 23,
    centered: 'BEL',
    country: 'USA',
    yeild: 0,
    fillKey: 'Attacker',
    date: '1954-03-01'
  },
  {
    name: 'Castle Bravo',
    radius: 25,
    yeild: 15000,
    country: 'USA',
    significance: 'First dry fusion fuel "staged" thermonuclear weapon; a serious nuclear fallout accident occurred',
    fillKey: 'Attacker',
    date: '1954-03-01',
    latitude: 11.415,
    longitude: 165.1619
  },{
    name: 'Tsar Bomba',
    radius: 70,
    yeild: 50000,
    country: 'USSR',
    fillKey: 'Defender',
    significance: 'Largest thermonuclear weapon ever testedâ€”scaled down from its initial 100 Mt design by 50%',
    date: '1961-10-31',
    latitude: 73.482,
    longitude: 54.5854
  }
];
var toggleBubbles = function() {
    if(bubblesShow) {
        bubble_map.bubbles([]);
        bubblesShow = false;
    } else {
        bubble_map.bubbles(bubbles, {popupTemplate: bubble_popup });
        bubblesShow = true;
    }
};

var map_bubbles = function(dataSet) {
    //TODO
    return dataSet.map(function(dataPoint) {

    });

};

var resetZoom = function () {
    bubble_map.svg.selectAll("g").attr("transform", "translate(0,0)scale(1.0)");
};

bubble_map.bubbles(bubbles, {
  popupTemplate: bubble_popup
});
</script>
</body>
</html>
